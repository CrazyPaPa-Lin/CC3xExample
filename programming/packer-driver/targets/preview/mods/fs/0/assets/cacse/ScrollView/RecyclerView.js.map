{"version":3,"sources":["file:///D:/CC3xExample/assets/cacse/ScrollView/RecyclerView.ts"],"names":["_decorator","Component","Node","ScrollView","game","Layout","Vec2","UITransform","Vec3","ccclass","property","requireComponent","RecyclerView","Map","Array","onLoad","_scrollView","node","getComponent","layout","content","console","error","_layoutType","type","_pdLeft","paddingLeft","_pdRight","paddingRight","_pdTop","paddingTop","_pdBottom","paddingBottom","_spaceX","spacingX","_spaceY","spacingY","_startAxis","startAxis","Type","NONE","_layout","reset","on","EventType","SIZE_CHANGED","sizeChanged","scrollView","SCROLLING","onScrolling","onDestroy","off","adapter","_isActive","_gener","_pool","clear","_childrens","length","initLayout","countParam","createItems","view","height","VERTICAL","halfScrollView","getItemCount","updateFun","updateV","HORIZONTAL","GRID","startIndex","offset","maxNum","total","Math","abs","y","getGeneratorLength","i","gener","index","item","itemType","getType","getItem","itemIndex","addChild","bottomY","lastItem","position","isInWindow","push","exeGenerator","createNextItem","createPreviousItem","firstItem","topY","unshift","point","getPositionInView","worldPos","convertToWorldSpaceAR","viewPos","convertToNodeSpaceAR","child","datas","get","pop","onCreateViewHolder","onBindViewHolder","removeItem","removeFromParent","isUp","lastContentPosY","childs","splice","lateUpdate","dt","bScrolling","ev","callback","params","result","generator","duration","Promise","resolve","reject","gen","execute","startTime","Date","getTime","iter","next","done","setTimeout","deltaTime","_adapter","v"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, ScrollView, game, Layout, Vec2, View, UITransform, Vec3, EventHandler } from 'cc';\nimport { BaseAdapter } from './BaseAdapter';\nimport { BaseViewHolder } from './BaseViewHolder';\nconst { ccclass, property, requireComponent } = _decorator;\n\n/**\n * Predefined variables\n * Name = SuperScrollView\n * DateTime = Sun Oct 17 2021 10:42:48 GMT+0400 (GMT+04:00)\n * Author = lin\n * FileBasename = RecyclerView.ts\n * FileBasenameNoExtension = RecyclerView\n * URL = db://assets/cacse/ScrollView/RecyclerView.ts\n * ManualUrl = https://docs.cocos.com/creator/3.3/manual/zh/\n *\n */\n\n@ccclass('RecyclerView')\n@requireComponent(ScrollView)\nexport class RecyclerView extends Component {\n\n\n    private _adapter: BaseAdapter = null;\n    public set adapter(v: BaseAdapter) {\n        this._adapter = v;\n        this.initLayout();\n    }\n    public get adapter(): BaseAdapter {\n        return this._adapter;\n    }\n\n\n    private _scrollView: ScrollView;\n    public get scrollView(): ScrollView {\n        return this._scrollView;\n    }\n\n    private _layout: Layout;\n\n    /**\n    * @en No layout.\n    * NONE = 0,\n    * @zh 禁用布局。\n    */\n\n    /**\n     * @en Horizontal layout.\n     *HORIZONTAL = 1,\n     * @zh 水平布局。\n     */\n\n    /**\n     * @en Vertical layout.\n     * VERTICAL = 2,\n     * @zh 垂直布局。\n     */\n\n    /**\n     * @en Grid layout.\n     * GRID = 3\n     * @zh 网格布局。\n     */\n    private _layoutType: number;\n    private _pdLeft: number;\n    private _pdRight: number;\n    private _pdTop: number;\n    private _pdBottom: number;\n    private _spaceX: number;\n    private _spaceY: number;\n    private _startAxis: number;\n    private halfScrollView: number = 0;\n    /**上一次content的Y值，用于和现在content的Y值比较，得出是向上还是向下滚动 */\n    private lastContentPosY: number = 0;\n    //分帧创建器\n    private _gener: Generator\n\n    private _isActive = true;\n\n    private _pool: Map<number, Array<BaseViewHolder>> = new Map();\n    private _childrens: Array<BaseViewHolder> = new Array();\n\n    /**刷新的函数 */\n    private updateFun: Function = function () { };\n\n    onLoad() {\n        this._scrollView = this.node.getComponent(ScrollView);\n        let layout = this._scrollView.content.getComponent(Layout);\n        if (!layout) {\n            console.error(\"请在content里面添加item布局方式\");\n        }\n        this._layoutType = layout.type;\n        this._pdLeft = layout.paddingLeft;\n        this._pdRight = layout.paddingRight;\n        this._pdTop = layout.paddingTop;\n        this._pdBottom = layout.paddingBottom;\n        this._spaceX = layout.spacingX;\n        this._spaceY = layout.spacingY;\n        this._startAxis = layout.startAxis;\n        //取消布局约束\n        layout.type = Layout.Type.NONE;\n        this._layout = layout;\n\n        this.reset();\n        this.node.on(Node.EventType.SIZE_CHANGED, this.sizeChanged, this);\n        this.scrollView.node.on(ScrollView.EventType.SCROLLING, this.onScrolling, this);\n    }\n\n    onDestroy() {\n        this.node.off(Node.EventType.SIZE_CHANGED, this.sizeChanged, this);\n        this.scrollView.node.off(ScrollView.EventType.SCROLLING, this.onScrolling, this);\n        this.adapter = null;\n        this._scrollView = null;\n        this._isActive = false;\n    }\n\n    //重置数据\n    private reset() {\n        this._gener?.return(\"\")//取消上一次的分帧任务（如果任务正在执行）\n        this._pool.clear();\n        this._childrens.length = 0;\n    }\n\n    //节点大小改变\n    private sizeChanged() {\n        if (this.adapter) {\n            this.reset();\n            this.initLayout();\n        }\n    }\n\n    //初始化面板\n    private initLayout() {\n        let layout = this._layout;\n        if (!layout) {\n            console.error(\"请在content里面添加item布局方式\");\n            return;\n        }\n        this.countParam();\n        this.createItems(0, new Vec2(0, this.scrollView.view.height));\n    }\n\n    private countParam() {\n        let type = this._layoutType;\n        if (type == Layout.Type.VERTICAL) {\n            this.halfScrollView = this.scrollView.view.height / 2;\n            this._layout.getComponent(UITransform).height = this.scrollView.view.height * this.adapter.getItemCount();\n            this.updateFun = this.updateV;\n        } else if (type == Layout.Type.HORIZONTAL) {\n\n        } else if (type == Layout.Type.GRID) {\n            let startAxis = this._startAxis;\n        }\n    }\n\n    /**\n     * \n     * @param startIndex 创建的起始节点\n     * @param offset 创建的偏移量\n     */\n    private createItems(startIndex: number, offset: Vec2) {\n        //取消上一次的分帧任务（如果任务正在执行）\n        this._gener?.return(\"\");\n\n        if (startIndex < 0) {\n            startIndex = 0;\n        }\n\n        let type = this._layoutType;\n        let maxNum = this.adapter.getItemCount();\n        let total = 0;\n        if (type == Layout.Type.VERTICAL) {\n            total = Math.abs(offset.y);\n        }\n\n        this._gener = this.getGeneratorLength(total, (i, gener) => {\n            if (!this._isActive) {\n                gener?.return(\"\")\n                return false;\n            }\n\n\n            let index = startIndex + i;\n            // if (type == Layout.Type.VERTICAL) {\n            //     if (offset.y > 0) {\n            //         index += 1;\n            //     } else {\n            //         index -= 1;\n            //     }\n            // }\n\n            if (index >= maxNum) {\n                //超出范围 则直接退出\n                gener?.return(\"\")\n                return false\n            }\n\n            let item: BaseViewHolder;\n            let itemType = this.adapter.getType(index);\n            item = this.getItem(itemType, index);\n            item.itemIndex = index;\n\n\n            this._layout.node.addChild(item.node);\n\n\n            if (type == Layout.Type.VERTICAL) {\n                if (offset.y > 0) {\n                    let bottomY = -this._pdTop;\n                    let lastItem = this._childrens[this._childrens.length - 1];\n                    if (lastItem) {\n                        bottomY = lastItem.node.position.y - lastItem.view.height / 2\n                            - this._spaceY;\n                    }\n                    item.node.position = new Vec3(0,\n                        bottomY - item.view.height / 2);\n                    if (!this.isInWindow(item)) {\n                        this._childrens.push(item);\n                        gener?.return(\"\")\n                        //创建结束\n                        return false;\n                    }\n                    if (i == maxNum - 1) {\n                        this._layout.node.getComponent(UITransform).height\n                            = Math.abs(item.node.position.y) + item.view.height / 2 + this._pdBottom;\n                    }\n                } else {\n                    //let top\n                }\n            }\n            this._childrens.push(item);\n            return true;\n        }, this._gener)\n\n        this.exeGenerator(this._gener, 4);\n    }\n\n    private createNextItem() {\n        let lastItem = this._childrens[this._childrens.length - 1];\n        if (!lastItem) {\n            return\n        }\n        let index = lastItem.itemIndex + 1;\n        if (index >= this.adapter.getItemCount()) {\n            return;\n        }\n        if (this.isInWindow(lastItem)) {\n            let item: BaseViewHolder;\n            let type = this._layoutType;\n            let itemType = this.adapter.getType(index);\n            item = this.getItem(itemType, index);\n            item.itemIndex = index;\n            this._layout.node.addChild(item.node);\n\n\n            if (type == Layout.Type.VERTICAL) {\n                let bottomY = -this._pdTop;\n                let lastItem = this._childrens[this._childrens.length - 1];\n                if (lastItem) {\n                    bottomY = lastItem.node.position.y - lastItem.view.height / 2\n                        - this._spaceY;\n                }\n                item.node.position = new Vec3(0,\n                    bottomY - item.view.height / 2);\n                if (index == this.adapter.getItemCount() - 1) {\n                    this._layout.node.getComponent(UITransform).height\n                        = Math.abs(item.node.position.y) + item.view.height / 2 + this._pdBottom;\n                }\n            }\n            this._childrens.push(item);\n            this.createNextItem();\n        }\n    }\n\n    private createPreviousItem(){\n        let firstItem = this._childrens[0];\n        if(!firstItem){\n            return\n        }\n        let index = firstItem.itemIndex - 1;\n        if(index < 0){\n            return\n        }\n        if(this.isInWindow(firstItem)){\n            let item: BaseViewHolder;\n            let type = this._layoutType;\n            let itemType = this.adapter.getType(index);\n            item = this.getItem(itemType, index);\n            item.itemIndex = index;\n            this._layout.node.addChild(item.node);\n\n\n            if (type == Layout.Type.VERTICAL) {\n                let topY = firstItem.node.position.y + firstItem.view.height / 2 + this._spaceY;\n                item.node.position = new Vec3(0,topY+item.view.height / 2);\n            }\n            this._childrens.unshift(item);\n            this.createPreviousItem();\n        }\n    }\n\n    //判断是否在窗口\n    private isInWindow(item: BaseViewHolder): boolean {\n        let point = this.getPositionInView(item);\n        let type = this._layoutType;\n        if (type == Layout.Type.VERTICAL) {\n            if (point.y - item.view.height / 2 > this.halfScrollView\n                || point.y + item.view.height / 2 < -this.halfScrollView) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    /**获取item在scrollView的局部坐标 */\n    private getPositionInView(item: BaseViewHolder): Vec3 {\n        let worldPos = this._layout.node.getComponent(UITransform).convertToWorldSpaceAR(item.node.position);\n        let viewPos = this.scrollView.view.convertToNodeSpaceAR(worldPos);\n        return viewPos;\n    }\n\n\n    /**获取一个列表项 */\n    private getItem(type, index) {\n        let child: BaseViewHolder;\n        let datas = this._pool.get(type);\n        if (datas && datas.length) {\n            child = datas.pop();\n        } else {\n            child = this.adapter.onCreateViewHolder(index)\n        }\n        this.adapter.onBindViewHolder(child, index);\n        return child;\n    }\n\n    private removeItem(item: BaseViewHolder) {\n        if (!item) { return }\n        item.node.removeFromParent();\n\n        let type = this.adapter.getType(item.itemIndex);\n        let datas = this._pool.get(type);\n        if (!datas) {\n            datas = new Array();\n        }\n        datas.push(item);\n        this._pool[type] = datas;\n    }\n\n    public updateV() {\n        let isUp = this._layout.node.position.y > this.lastContentPosY;\n        let childs = this._childrens;\n        for (let i = 0; i < childs.length; ++i) {\n            let item = childs[i];\n            let viewPos = this.getPositionInView(item);\n            if(childs.length <= 1){\n                //必须要剩一个 不然就全部被删除了\n                break\n            }\n            if (isUp) {\n                //如果item超过上边界 那么就移除\n                if (viewPos.y - item.view.height / 2 > this.halfScrollView) {\n                    this.removeItem(item);\n                    childs.splice(i,1);\n                    i--;\n                }\n            } else {\n                if (viewPos.y + item.view.height / 2 < -this.halfScrollView) {\n                    this.removeItem(item);\n                    childs.splice(i,1);\n                    i--;\n                }\n            }\n        }\n\n        if (isUp) {\n            //创建下一个\n            this.createNextItem();\n        }else{\n            //创建上一个\n            this.createPreviousItem();\n        }\n        this.lastContentPosY = this._layout.node.position.y;\n    }\n\n\n\n    /**是否滚动容器 */\n    private bScrolling: boolean = false;\n    lateUpdate(dt) {\n        if (this.bScrolling == false) {\n            return;\n        }\n        this.bScrolling = false;\n        this.updateFun();\n    }\n\n    public onScrolling(ev: Event = null) {\n        this.bScrolling = true;\n    }\n\n    /** 分帧加载 */\n    private * getGeneratorLength(length: number, callback: Function, ...params: any): Generator {\n        for (let i = 0; i < length; i++) {\n            let result = callback(i, ...params)\n            if (result) {\n                yield\n            } else {\n                return\n            }\n        }\n    }\n\n    /** 分帧执行 */\n    private exeGenerator(generator: Generator, duration: number) {\n        return new Promise<void>((resolve, reject) => {\n            let gen = generator\n            let execute = () => {\n                let startTime = new Date().getTime()\n                for (let iter = gen.next(); ; iter = gen.next()) {\n                    if (iter == null || iter.done) {\n                        resolve()\n                        return\n                    }\n                    if (new Date().getTime() - startTime > duration) {\n                        setTimeout(() => execute(), game.deltaTime * 1000)\n                        return\n                    }\n                }\n            }\n            execute()\n        })\n    }\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.3/manual/zh/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.3/manual/zh/scripting/ccclass.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.3/manual/zh/scripting/life-cycle-callbacks.html\n */\n\n/**\n * type\n * node h * 10;\n *\n * 垂直布局\n * anchor 0.5  1.0\n *\n * 创建 1个 item\n * 填充位置\n * 添加至content\n *\n * 判断该节点底部是否 超过 下边界\n * 超过\n * 则判断是否是创建的最后一个节点\n * 是 那么 内容高度 = 当前节点的bottom位置 + bottom边界值\n * 则退出创建\n *\n * 不超过 则判断是否是创建的最后一个节点\n * 是 那么 内容高度 = 当前节点的bottom位置 + bottom边界值\n * 不是 那么继续创建下一个item\n *\n * 滑动\n * 向上滑动\n * 判断最后一个节点是否在屏幕内\n * 在\n * 则判断是否是创建的最后一个节点\n * 不是 则创建（滑动距离的item）\n * 是 则退出\n *\n * 向下滑动\n * 判断第一个节点是否在屏幕内\n * 在\n * 则判断index是否为0\n * 是\n * 则退出\n * 不是 则创建（滑动距离的item）\n * 退出\n *\n * 获取最大节点的宽高 * 总个数\n *\n *\n */\n"]}