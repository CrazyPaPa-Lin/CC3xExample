{"version":3,"sources":["file:///D:/CC3xExample/assets/cacse/ScrollView/RecyclerView.ts"],"names":["_decorator","Component","Node","ScrollView","game","Layout","Vec2","UITransform","Vec3","ccclass","property","requireComponent","RecyclerView","Map","Array","adapter","v","_adapter","initLayout","scrollView","_scrollView","onLoad","node","getComponent","layout","content","console","error","_layoutType","type","_pdLeft","paddingLeft","_pdRight","paddingRight","_pdTop","paddingTop","_pdBottom","paddingBottom","_spaceX","spacingX","_spaceY","spacingY","_startAxis","startAxis","Type","NONE","_layout","reset","on","EventType","SIZE_CHANGED","sizeChanged","SCROLLING","onScrolling","onDestroy","off","_isActive","_gener","return","_pool","clear","_childrens","length","countParam","createItems","view","height","VERTICAL","halfScrollView","getItemCount","updateFun","updateV","HORIZONTAL","GRID","startIndex","offset","maxNum","total","Math","abs","y","getGeneratorLength","i","gener","index","item","itemType","getType","getItem","itemIndex","addChild","bottomY","lastItem","position","isInWindow","push","exeGenerator","createNextItem","createPreviousItem","firstItem","topY","unshift","point","getPositionInView","worldPos","convertToWorldSpaceAR","viewPos","convertToNodeSpaceAR","child","datas","get","pop","onCreateViewHolder","onBindViewHolder","removeItem","removeFromParent","isUp","lastContentPosY","childs","splice","lateUpdate","dt","bScrolling","ev","callback","params","result","generator","duration","Promise","resolve","reject","gen","execute","startTime","Date","getTime","iter","next","done","setTimeout","deltaTime"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, ScrollView, game, Layout, Vec2, View, UITransform, Vec3, EventHandler } from 'cc';\nimport { BaseAdapter } from './BaseAdapter';\nimport { BaseViewHolder } from './BaseViewHolder';\nconst { ccclass, property, requireComponent } = _decorator;\n\n/**\n * Predefined variables\n * Name = SuperScrollView\n * DateTime = Sun Oct 17 2021 10:42:48 GMT+0400 (GMT+04:00)\n * Author = lin\n * FileBasename = RecyclerView.ts\n * FileBasenameNoExtension = RecyclerView\n * URL = db://assets/cacse/ScrollView/RecyclerView.ts\n * ManualUrl = https://docs.cocos.com/creator/3.3/manual/zh/\n *\n */\n\n@ccclass('RecyclerView')\n@requireComponent(ScrollView)\nexport class RecyclerView extends Component {\n\n\n    private _adapter: BaseAdapter = null;\n    public set adapter(v: BaseAdapter) {\n        this._adapter = v;\n        this.initLayout();\n    }\n    public get adapter(): BaseAdapter {\n        return this._adapter;\n    }\n\n\n    private _scrollView: ScrollView;\n    public get scrollView(): ScrollView {\n        return this._scrollView;\n    }\n\n    private _layout: Layout;\n\n    /**\n    * @en No layout.\n    * NONE = 0,\n    * @zh 禁用布局。\n    */\n\n    /**\n     * @en Horizontal layout.\n     *HORIZONTAL = 1,\n     * @zh 水平布局。\n     */\n\n    /**\n     * @en Vertical layout.\n     * VERTICAL = 2,\n     * @zh 垂直布局。\n     */\n\n    /**\n     * @en Grid layout.\n     * GRID = 3\n     * @zh 网格布局。\n     */\n    private _layoutType: number;\n    private _pdLeft: number;\n    private _pdRight: number;\n    private _pdTop: number;\n    private _pdBottom: number;\n    private _spaceX: number;\n    private _spaceY: number;\n    private _startAxis: number;\n    private halfScrollView: number = 0;\n    /**上一次content的Y值，用于和现在content的Y值比较，得出是向上还是向下滚动 */\n    private lastContentPosY: number = 0;\n    //分帧创建器\n    private _gener: Generator\n\n    private _isActive = true;\n\n    private _pool: Map<number, Array<BaseViewHolder>> = new Map();\n    private _childrens: Array<BaseViewHolder> = new Array();\n\n    /**刷新的函数 */\n    private updateFun: Function = function () { };\n\n    onLoad() {\n        this._scrollView = this.node.getComponent(ScrollView);\n        let layout = this._scrollView.content.getComponent(Layout);\n        if (!layout) {\n            console.error(\"请在content里面添加item布局方式\");\n        }\n        this._layoutType = layout.type;\n        this._pdLeft = layout.paddingLeft;\n        this._pdRight = layout.paddingRight;\n        this._pdTop = layout.paddingTop;\n        this._pdBottom = layout.paddingBottom;\n        this._spaceX = layout.spacingX;\n        this._spaceY = layout.spacingY;\n        this._startAxis = layout.startAxis;\n        //取消布局约束\n        layout.type = Layout.Type.NONE;\n        this._layout = layout;\n\n        this.reset();\n        this.node.on(Node.EventType.SIZE_CHANGED, this.sizeChanged, this);\n        this.scrollView.node.on(ScrollView.EventType.SCROLLING, this.onScrolling, this);\n    }\n\n    onDestroy() {\n        this.node.off(Node.EventType.SIZE_CHANGED, this.sizeChanged, this);\n        this.scrollView.node.off(ScrollView.EventType.SCROLLING, this.onScrolling, this);\n        this.adapter = null;\n        this._scrollView = null;\n        this._isActive = false;\n    }\n\n    //重置数据\n    private reset() {\n        this._gener?.return(\"\")//取消上一次的分帧任务（如果任务正在执行）\n        this._pool.clear();\n        this._childrens.length = 0;\n    }\n\n    //节点大小改变\n    private sizeChanged() {\n        if (this.adapter) {\n            this.reset();\n            this.initLayout();\n        }\n    }\n\n    //初始化面板\n    private initLayout() {\n        let layout = this._layout;\n        if (!layout) {\n            console.error(\"请在content里面添加item布局方式\");\n            return;\n        }\n        this.countParam();\n        this.createItems(0, new Vec2(0, this.scrollView.view.height));\n    }\n\n    private countParam() {\n        let type = this._layoutType;\n        if (type == Layout.Type.VERTICAL) {\n            this.halfScrollView = this.scrollView.view.height / 2;\n            this._layout.getComponent(UITransform).height = this.scrollView.view.height * this.adapter.getItemCount();\n            this.updateFun = this.updateV;\n        } else if (type == Layout.Type.HORIZONTAL) {\n\n        } else if (type == Layout.Type.GRID) {\n            let startAxis = this._startAxis;\n        }\n    }\n\n    /**\n     * \n     * @param startIndex 创建的起始节点\n     * @param offset 创建的偏移量\n     */\n    private createItems(startIndex: number, offset: Vec2) {\n        //取消上一次的分帧任务（如果任务正在执行）\n        this._gener?.return(\"\");\n\n        if (startIndex < 0) {\n            startIndex = 0;\n        }\n\n        let type = this._layoutType;\n        let maxNum = this.adapter.getItemCount();\n        let total = 0;\n        if (type == Layout.Type.VERTICAL) {\n            total = Math.abs(offset.y);\n        }\n\n        this._gener = this.getGeneratorLength(total, (i, gener) => {\n            if (!this._isActive) {\n                gener?.return(\"\")\n                return false;\n            }\n\n\n            let index = startIndex + i;\n            // if (type == Layout.Type.VERTICAL) {\n            //     if (offset.y > 0) {\n            //         index += 1;\n            //     } else {\n            //         index -= 1;\n            //     }\n            // }\n\n            if (index >= maxNum) {\n                //超出范围 则直接退出\n                gener?.return(\"\")\n                return false\n            }\n\n            let item: BaseViewHolder;\n            let itemType = this.adapter.getType(index);\n            item = this.getItem(itemType, index);\n            item.itemIndex = index;\n\n\n            this._layout.node.addChild(item.node);\n\n\n            if (type == Layout.Type.VERTICAL) {\n                if (offset.y > 0) {\n                    let bottomY = -this._pdTop;\n                    let lastItem = this._childrens[this._childrens.length - 1];\n                    if (lastItem) {\n                        bottomY = lastItem.node.position.y - lastItem.view.height / 2\n                            - this._spaceY;\n                    }\n                    item.node.position = new Vec3(0,\n                        bottomY - item.view.height / 2);\n                    if (!this.isInWindow(item)) {\n                        this._childrens.push(item);\n                        gener?.return(\"\")\n                        //创建结束\n                        return false;\n                    }\n                    if (i == maxNum - 1) {\n                        this._layout.node.getComponent(UITransform).height\n                            = Math.abs(item.node.position.y) + item.view.height / 2 + this._pdBottom;\n                    }\n                } else {\n                    //let top\n                }\n            }\n            this._childrens.push(item);\n            return true;\n        }, this._gener)\n\n        this.exeGenerator(this._gener, 4);\n    }\n\n    private createNextItem() {\n        let lastItem = this._childrens[this._childrens.length - 1];\n        if (!lastItem) {\n            return\n        }\n        let index = lastItem.itemIndex + 1;\n        if (index >= this.adapter.getItemCount()) {\n            return;\n        }\n        if (this.isInWindow(lastItem)) {\n            let item: BaseViewHolder;\n            let type = this._layoutType;\n            let itemType = this.adapter.getType(index);\n            item = this.getItem(itemType, index);\n            item.itemIndex = index;\n            this._layout.node.addChild(item.node);\n\n\n            if (type == Layout.Type.VERTICAL) {\n                let bottomY = -this._pdTop;\n                let lastItem = this._childrens[this._childrens.length - 1];\n                if (lastItem) {\n                    bottomY = lastItem.node.position.y - lastItem.view.height / 2\n                        - this._spaceY;\n                }\n                item.node.position = new Vec3(0,\n                    bottomY - item.view.height / 2);\n                if (index == this.adapter.getItemCount() - 1) {\n                    this._layout.node.getComponent(UITransform).height\n                        = Math.abs(item.node.position.y) + item.view.height / 2 + this._pdBottom;\n                }\n            }\n            this._childrens.push(item);\n            this.createNextItem();\n        }\n    }\n\n    private createPreviousItem(){\n        let firstItem = this._childrens[0];\n        if(!firstItem){\n            return\n        }\n        let index = firstItem.itemIndex - 1;\n        if(index < 0){\n            return\n        }\n        if(this.isInWindow(firstItem)){\n            let item: BaseViewHolder;\n            let type = this._layoutType;\n            let itemType = this.adapter.getType(index);\n            item = this.getItem(itemType, index);\n            item.itemIndex = index;\n            this._layout.node.addChild(item.node);\n\n\n            if (type == Layout.Type.VERTICAL) {\n                let topY = firstItem.node.position.y + firstItem.view.height / 2 + this._spaceY;\n                item.node.position = new Vec3(0,topY+item.view.height / 2);\n            }\n            this._childrens.unshift(item);\n            this.createPreviousItem();\n        }\n    }\n\n    //判断是否在窗口\n    private isInWindow(item: BaseViewHolder): boolean {\n        let point = this.getPositionInView(item);\n        let type = this._layoutType;\n        if (type == Layout.Type.VERTICAL) {\n            if (point.y - item.view.height / 2 > this.halfScrollView\n                || point.y + item.view.height / 2 < -this.halfScrollView) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    /**获取item在scrollView的局部坐标 */\n    private getPositionInView(item: BaseViewHolder): Vec3 {\n        let worldPos = this._layout.node.getComponent(UITransform).convertToWorldSpaceAR(item.node.position);\n        let viewPos = this.scrollView.view.convertToNodeSpaceAR(worldPos);\n        return viewPos;\n    }\n\n\n    /**获取一个列表项 */\n    private getItem(type, index) {\n        let child: BaseViewHolder;\n        let datas = this._pool.get(type);\n        if (datas && datas.length) {\n            child = datas.pop();\n        } else {\n            child = this.adapter.onCreateViewHolder(index)\n        }\n        this.adapter.onBindViewHolder(child, index);\n        return child;\n    }\n\n    private removeItem(item: BaseViewHolder) {\n        if (!item) { return }\n        item.node.removeFromParent();\n\n        let type = this.adapter.getType(item.itemIndex);\n        let datas = this._pool.get(type);\n        if (!datas) {\n            datas = new Array();\n        }\n        datas.push(item);\n        this._pool[type] = datas;\n    }\n\n    public updateV() {\n        let isUp = this._layout.node.position.y > this.lastContentPosY;\n        let childs = this._childrens;\n        for (let i = 0; i < childs.length; ++i) {\n            let item = childs[i];\n            let viewPos = this.getPositionInView(item);\n            if(childs.length <= 1){\n                //必须要剩一个 不然就全部被删除了\n                break\n            }\n            if (isUp) {\n                //如果item超过上边界 那么就移除\n                if (viewPos.y - item.view.height / 2 > this.halfScrollView) {\n                    this.removeItem(item);\n                    childs.splice(i,1);\n                    i--;\n                }\n            } else {\n                if (viewPos.y + item.view.height / 2 < -this.halfScrollView) {\n                    this.removeItem(item);\n                    childs.splice(i,1);\n                    i--;\n                }\n            }\n        }\n\n        if (isUp) {\n            //创建下一个\n            this.createNextItem();\n        }else{\n            //创建上一个\n            this.createPreviousItem();\n        }\n        this.lastContentPosY = this._layout.node.position.y;\n    }\n\n\n\n    /**是否滚动容器 */\n    private bScrolling: boolean = false;\n    lateUpdate(dt) {\n        if (this.bScrolling == false) {\n            return;\n        }\n        this.bScrolling = false;\n        this.updateFun();\n    }\n\n    public onScrolling(ev: Event = null) {\n        this.bScrolling = true;\n    }\n\n    /** 分帧加载 */\n    private * getGeneratorLength(length: number, callback: Function, ...params: any): Generator {\n        for (let i = 0; i < length; i++) {\n            let result = callback(i, ...params)\n            if (result) {\n                yield\n            } else {\n                return\n            }\n        }\n    }\n\n    /** 分帧执行 */\n    private exeGenerator(generator: Generator, duration: number) {\n        return new Promise<void>((resolve, reject) => {\n            let gen = generator\n            let execute = () => {\n                let startTime = new Date().getTime()\n                for (let iter = gen.next(); ; iter = gen.next()) {\n                    if (iter == null || iter.done) {\n                        resolve()\n                        return\n                    }\n                    if (new Date().getTime() - startTime > duration) {\n                        setTimeout(() => execute(), game.deltaTime * 1000)\n                        return\n                    }\n                }\n            }\n            execute()\n        })\n    }\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.3/manual/zh/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.3/manual/zh/scripting/ccclass.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.3/manual/zh/scripting/life-cycle-callbacks.html\n */\n\n/**\n * type\n * node h * 10;\n *\n * 垂直布局\n * anchor 0.5  1.0\n *\n * 创建 1个 item\n * 填充位置\n * 添加至content\n *\n * 判断该节点底部是否 超过 下边界\n * 超过\n * 则判断是否是创建的最后一个节点\n * 是 那么 内容高度 = 当前节点的bottom位置 + bottom边界值\n * 则退出创建\n *\n * 不超过 则判断是否是创建的最后一个节点\n * 是 那么 内容高度 = 当前节点的bottom位置 + bottom边界值\n * 不是 那么继续创建下一个item\n *\n * 滑动\n * 向上滑动\n * 判断最后一个节点是否在屏幕内\n * 在\n * 则判断是否是创建的最后一个节点\n * 不是 则创建（滑动距离的item）\n * 是 则退出\n *\n * 向下滑动\n * 判断第一个节点是否在屏幕内\n * 在\n * 则判断index是否为0\n * 是\n * 则退出\n * 不是 则创建（滑动距离的item）\n * 退出\n *\n * 获取最大节点的宽高 * 总个数\n *\n *\n */\n"]}