{"version":3,"sources":["file:///D:/WuHunDalu2D/3DProject/CC3xExample/Cocos%20creator%203.x%20Example/assets/cacse/ScrollView/SuperScrollView.ts"],"names":["_decorator","Component","Node","ScrollView","game","Layout","Vec2","UITransform","Vec3","EventHandler","ccclass","property","requireComponent","RecyclerView","type","tooltip","Map","Array","adapter","v","_adapter","initLayout","scrollView","_scrollView","start","node","getComponent","layout","content","console","error","_layoutType","_pdLeft","paddingLeft","_pdRight","paddingRight","_pdTop","paddingTop","_pdBottom","paddingBottom","_spaceX","spacingX","_spaceY","spacingY","_startAxis","startAxis","Type","NONE","_layout","reset","on","EventType","SIZE_CHANGED","sizeChanged","onDestroy","off","_isActive","_gener","return","_pool","clear","_childrens","length","countParam","createItems","view","height","halfScrollView","width","VERTICAL","updateFun","updateV","HORIZONTAL","GRID","startIndex","offset","maxNum","getItemCount","total","Math","abs","y","getGeneratorLength","i","index","item","itemType","getType","getItem","itemIndex","addChild","push","bottomY","lastItem","position","isInWindow","point","getPositionInView","worldPos","convertToWorldSpaceAR","viewPos","convertToNodeSpaceAR","child","datas","get","pop","onCreateViewHolder","onBindViewHolder","removeItem","removeFromParent","isUp","lastContentPosY","childs","splice","callback","params","result","exeGenerator","generator","duration","Promise","resolve","reject","gen","execute","startTime","Date","getTime","iter","next","done","setTimeout","deltaTime"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, ScrollView, game, Layout, Vec2, View, UITransform, Vec3, EventHandler } from 'cc';\nimport { BaseAdapter } from './BaseAdapter';\nimport { BaseViewHolder } from './BaseViewHolder';\nconst { ccclass, property, requireComponent } = _decorator;\n\n/**\n * Predefined variables\n * Name = SuperScrollView\n * DateTime = Sun Oct 17 2021 10:42:48 GMT+0400 (GMT+04:00)\n * Author = lin\n * FileBasename = RecyclerView.ts\n * FileBasenameNoExtension = RecyclerView\n * URL = db://assets/cacse/ScrollView/RecyclerView.ts\n * ManualUrl = https://docs.cocos.com/creator/3.3/manual/zh/\n *\n */\n\n@ccclass('RecyclerView')\n@requireComponent(ScrollView)\nexport class RecyclerView extends Component {\n\n\n    private _adapter: BaseAdapter = null;\n    public set adapter(v: BaseAdapter) {\n        this._adapter = v;\n        this.initLayout();\n    }\n    public get adapter(): BaseAdapter {\n        return this._adapter;\n    }\n\n\n\n    @property({ type: [EventHandler], tooltip: '节点刷新函数' })\n    refreshItemEvents: EventHandler[] = [];\n\n    private _scrollView: ScrollView;\n    public get scrollView(): ScrollView {\n        return this._scrollView;\n    }\n\n    private _layout: Layout;\n\n    /**\n    * @en No layout.\n    * NONE = 0,\n    * @zh 禁用布局。\n    */\n\n    /**\n     * @en Horizontal layout.\n     *HORIZONTAL = 1,\n     * @zh 水平布局。\n     */\n\n    /**\n     * @en Vertical layout.\n     * VERTICAL = 2,\n     * @zh 垂直布局。\n     */\n\n    /**\n     * @en Grid layout.\n     * GRID = 3\n     * @zh 网格布局。\n     */\n    private _layoutType: number;\n    private _pdLeft: number;\n    private _pdRight: number;\n    private _pdTop: number;\n    private _pdBottom: number;\n    private _spaceX: number;\n    private _spaceY: number;\n    private _startAxis: number;\n    private halfScrollView: number = 0;\n     /**上一次content的Y值，用于和现在content的Y值比较，得出是向上还是向下滚动 */\n     private lastContentPosY: number = 0;\n    //分帧创建器\n    private _gener: Generator\n\n    private _isActive = true;\n\n    private _pool: Map<number, Array<BaseViewHolder>> = new Map();\n    private _childrens: Array<BaseViewHolder> = new Array();\n\n    /**刷新的函数 */\n    private updateFun: Function = function () { };\n\n    start() {\n        this._scrollView = this.node.getComponent(ScrollView);\n        let layout = this._scrollView.content.getComponent(Layout);\n        if (!layout) {\n            console.error(\"请在content里面添加item布局方式\");\n        }\n        this._layoutType = layout.type;\n        this._pdLeft = layout.paddingLeft;\n        this._pdRight = layout.paddingRight;\n        this._pdTop = layout.paddingTop;\n        this._pdBottom = layout.paddingBottom;\n        this._spaceX = layout.spacingX;\n        this._spaceY = layout.spacingY;\n        this._startAxis = layout.startAxis;\n        //取消布局约束\n        layout.type = Layout.Type.NONE;\n        this._layout = layout;\n\n        this.reset();\n        this.node.on(Node.EventType.SIZE_CHANGED, this.sizeChanged, this);\n    }\n\n    onDestroy() {\n        this.node.off(Node.EventType.SIZE_CHANGED, this.sizeChanged, this);\n        this.adapter = null;\n        this._scrollView = null;\n        this._isActive = false;\n    }\n\n    //重置数据\n    private reset() {\n        this._gener?.return(\"\")//取消上一次的分帧任务（如果任务正在执行）\n        this._pool.clear();\n        this._childrens.length = 0;\n    }\n\n    //节点大小改变\n    private sizeChanged() {\n        if (this.adapter) {\n            this.reset();\n            this.initLayout();\n        }\n    }\n\n    //初始化面板\n    private initLayout() {\n        let layout = this._layout;\n        if (!layout) {\n            console.error(\"请在content里面添加item布局方式\");\n            return;\n        }\n        this.countParam();\n        this.createItems(0, new Vec2(0, this.scrollView.view.height));\n    }\n\n    private countParam() {\n        let type = this._layoutType;\n        this.halfScrollView = this.scrollView.view.width / 2;\n        if (type == Layout.Type.VERTICAL) {\n            this.updateFun = this.updateV;\n        } else if (type == Layout.Type.HORIZONTAL) {\n\n        } else if (type == Layout.Type.GRID) {\n            let startAxis = this._startAxis;\n        }\n    }\n\n    /**\n     * \n     * @param startIndex 创建的起始节点\n     * @param offset 创建的偏移量\n     */\n    private createItems(startIndex: number, offset: Vec2) {\n        //取消上一次的分帧任务（如果任务正在执行）\n        this._gener?.return(\"\");\n\n        if (startIndex < 0) {\n            startIndex = 0;\n        }\n\n        let type = this._layoutType;\n        let maxNum = this.adapter.getItemCount();\n        let total = 0;\n        if (type == Layout.Type.VERTICAL) {\n            total = Math.abs(offset.y);\n        }\n\n        this._gener = this.getGeneratorLength(total, (i) => {\n            if (!this._isActive) {\n                return;\n            }\n\n\n            let index = startIndex\n            if (type == Layout.Type.VERTICAL) {\n                if (offset.y > 0) {\n                    index += 1;\n                } else {\n                    index -= 1;\n                }\n            }\n\n            if (index >= maxNum) {\n                //超出范围 则直接退出\n                this._gener?.return(\"\");\n                return\n            }\n\n            let item: BaseViewHolder;\n            let itemType = this.adapter.getType(index);\n            item = this.getItem(itemType, i);\n            item.itemIndex = i;\n\n\n            this._layout.node.addChild(item.node);\n            this._childrens.push(item);\n\n            if (type == Layout.Type.VERTICAL) {\n                if (offset.y > 0) {\n                    let bottomY = this._pdTop;\n                    let lastItem = this._childrens[this._childrens.length - 1];\n                    if (lastItem) {\n                        bottomY = lastItem.node.position.y + lastItem.view.height / 2\n                            + this._spaceY;\n                    }\n                    item.node.position = new Vec3(this.scrollView.view.width / 2,\n                        bottomY + item.view.height / 2);\n                    if (!this.isInWindow(item)) {\n                        //创建结束\n                        this._gener?.return(\"\");\n                        return;\n                    }\n                    if (i == maxNum - 1) {\n                        this._layout.node.getComponent(UITransform).height\n                            = Math.abs(item.node.position.y) + item.view.height / 2;\n                    }\n                } else {\n                    //let top\n                }\n            }\n        })\n\n\n    }\n\n    //判断是否在窗口\n    private isInWindow(item: BaseViewHolder): boolean {\n        let point = this.getPositionInView(item);\n        let type = this._layoutType;\n        if (type == Layout.Type.VERTICAL) {\n            if (point.y + item.view.height / 2 >= -this.halfScrollView\n                || point.y - item.view.height / 2 <= this.halfScrollView) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**获取item在scrollView的局部坐标 */\n    private getPositionInView(item: BaseViewHolder): Vec3 {\n        let worldPos = item.view.convertToWorldSpaceAR(item.node.position);\n        let viewPos = this.scrollView.view.convertToNodeSpaceAR(worldPos);\n        return viewPos;\n    }\n\n\n    /**获取一个列表项 */\n    private getItem(type, index) {\n        let child:BaseViewHolder;\n        let datas = this._pool.get(type);\n        if (datas && datas.length) {\n            child = datas.pop();\n        } else {\n            child = this.adapter.onCreateViewHolder(index)\n        }\n        this.adapter.onBindViewHolder(child,index);\n        return child;\n    }\n\n    private removeItem(item:BaseViewHolder) {\n        if (!item) { return }\n        item.node.removeFromParent();\n\n        let type = this.adapter.getType(item.itemIndex);\n        let datas = this._pool.get(type);\n        if(!datas){\n            datas = new Array();\n        }\n        datas.push(item);\n        this._pool[type] = datas;\n    }\n\n    public updateV(){\n        let isUp = this._layout.node.position.y > this.lastContentPosY;\n        let childs = this._childrens;\n        for(let i = 0 ; i < childs.length; ++i){\n            let item = childs[i];\n            let viewPos = this.getPositionInView(item);\n            if(isUp){\n                //如果item超过上边界 那么就移除\n                if(viewPos.y - item.view.height / 2 > this.halfScrollView){\n                    this.removeItem(item);\n                    childs.splice(i,1);\n                    i--;\n                }\n            }else{\n                if(viewPos.y + item.view.height / 2 < this.halfScrollView){\n                    this.removeItem(item);\n                    childs.splice(i,1);\n                    i--;\n                }\n            }\n        }\n\n        if(isUp){\n            this.createItems(childs[childs.length - 1].itemIndex + 1,new Vec2(0,this.scrollView.view.height));\n        }else{\n            \n        }\n        this.lastContentPosY = this._layout.node.position.y;\n    }\n\n\n\n    /** 分帧加载 */\n    private * getGeneratorLength(length: number, callback: Function, ...params: any): Generator {\n        for (let i = 0; i < length; i++) {\n            let result = callback(i, ...params)\n            if (result) {\n                yield\n            } else {\n                return\n            }\n        }\n    }\n\n    /** 分帧执行 */\n    private exeGenerator(generator: Generator, duration: number) {\n        return new Promise<void>((resolve, reject) => {\n            let gen = generator\n            let execute = () => {\n                let startTime = new Date().getTime()\n                for (let iter = gen.next(); ; iter = gen.next()) {\n                    if (iter == null || iter.done) {\n                        resolve()\n                        return\n                    }\n                    if (new Date().getTime() - startTime > duration) {\n                        setTimeout(() => execute(), game.deltaTime * 1000)\n                        return\n                    }\n                }\n            }\n            execute()\n        })\n    }\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.3/manual/zh/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.3/manual/zh/scripting/ccclass.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.3/manual/zh/scripting/life-cycle-callbacks.html\n */\n\n/**\n * type\n * node h * 10;\n *\n * 垂直布局\n * anchor 0.5  1.0\n *\n * 创建 1个 item\n * 填充位置\n * 添加至content\n *\n * 判断该节点底部是否 超过 下边界\n * 超过\n * 则判断是否是创建的最后一个节点\n * 是 那么 内容高度 = 当前节点的bottom位置 + bottom边界值\n * 则退出创建\n *\n * 不超过 则判断是否是创建的最后一个节点\n * 是 那么 内容高度 = 当前节点的bottom位置 + bottom边界值\n * 不是 那么继续创建下一个item\n *\n * 滑动\n * 向上滑动\n * 判断最后一个节点是否在屏幕内\n * 在\n * 则判断是否是创建的最后一个节点\n * 不是 则创建（滑动距离的item）\n * 是 则退出\n *\n * 向下滑动\n * 判断第一个节点是否在屏幕内\n * 在\n * 则判断index是否为0\n * 是\n * 则退出\n * 不是 则创建（滑动距离的item）\n * 退出\n */\n"]}